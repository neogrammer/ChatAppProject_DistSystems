syntax = "proto3";

package chat;

option csharp_namespace = "_3420_Chat_Service";

message ChatMessage {
  string id        = 1;  // stringified DB id
  string roomId    = 2;
  string userId    = 3;
  string userName  = 4;
  string content   = 5;
  int64  createdAt = 6;  // unix millis
}

message SendMessageResponse {
  bool success = 1;
}

message GetMessagesRequest {
  string groupId = 1;
}

message GetMessagesResponse {
  repeated ChatMessage messages = 1;
}

message CreateGroupRequest {
  string groupName = 1;
  string userId = 2;
}

message CreateGroupResponse {
  bool success = 1;
  string groupId = 2;
}

message AddUserToGroupRequest {
  string groupId = 1;
  string userId = 2;
}

message AddUserToGroupResponse {
  bool success = 1;
}

message GetUserGroupsRequest {
  string userId = 1;
}

message GroupInfo {
  string id = 1;
  string groupName = 2;
}

message GetUserGroupsResponse {
  repeated GroupInfo groups = 1;
}

message SearchUsersRequest {
  string query = 1;
  string userId = 2;
}

message UserInfo {
  string userId = 1;
  string email = 2;
  string displayName = 3;
}

message SearchUsersResponse {
  repeated UserInfo users = 1;
}

service ChatService {
  rpc SendMessage(ChatMessage) returns (SendMessageResponse);
  rpc GetMessages(GetMessagesRequest) returns (GetMessagesResponse);
  rpc CreateGroup(CreateGroupRequest) returns (CreateGroupResponse);
  rpc AddUserToGroup(AddUserToGroupRequest) returns (AddUserToGroupResponse);
  rpc GetUserGroups(GetUserGroupsRequest) returns (GetUserGroupsResponse);
  rpc SearchUsers(SearchUsersRequest) returns (SearchUsersResponse);
}